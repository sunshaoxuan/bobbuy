---
引用: PROD-02-业务功能详细说明
状态: 草案
生效日期: 2026-01-13
---

# ARCH-03: 采购执行与商品采集详细设计

## 1. 模块概述
采购执行模块是平台数据采集的源头。在真实卖场环境下，通过高频影像采集、AI 结构化解析、实时外部搜索以及全动态同步机制，确保商家采购动作与客户预购清单的高度一致。

## 2. 商品影像采集与处理 (前端流水线)
由于商家在卖场内会进行高频拍摄（短时间几十张），系统必须建立高效的前端处理通道。

-   **采集策略**：
    -   **连拍优化**：内置摄像头支持快速连拍模式，减少快门延迟。
    -   **本地预处理**：在图片上传前，移动端应根据网络环境自动执行：
        -   **尺寸调整 (Resizing)**：统一调整至适合 AI 识别的分辨率（如 2000px 边长），平衡清晰度与上传速度。
        -   **数据清洗 (Pre-cleaning)**：自动校正倾斜（Deskew）、优化对比度、去除反光噪点，提高 OCR 识别率。
    -   **地理位置自动匹配**：利用拍摄时的 GPS 数据，自动关联商家当前所在的卖场/店铺档案。

## 3. AI 多模态识别引擎
### 3.1 模型选型建议
-   **方案建议**：**混合式模型架构 (Hybrid Approach)**。
    -   **边缘侧小模型 (Lightweight OCR/Detection)**：用于前端实时反馈图片质量（如：提醒照片模糊、未拍到价格标签）。
    -   **云端多模态大模型 (MLLM, 如 GPT-4o 或 Gemini 1.5 Pro)**：作为核心解析引擎。
-   **理由**：卖场价格标签极其复杂（包含会员价、非会员价、买二送一、各种语言混杂），小模型针对此类非标且带有语义关联的数据解析率极低。大模型能够精准通过视觉关联，识别出“优惠期限、现价、原价”等深层语义信息。

### 3.2 识别字段定义
-   **核心字段**：品名、规格（如 1.5L/2kg）、商家商品内部编号（如有）、UPC/SKU 码。
-   **价格矩阵**：原价、现价（实际购买价）、优惠金额、优惠结束期限。

## 4. 外部数据增强与关联搜索
-   **自动增强流程**：
    -   当 AI 提取到 UPC 或确定的品名后，系统自动触发异步任务：
        -   **搜索引擎接口**：请求官方大图（White-background images）及跨语言说明。
        -   **官方库比对**：从零售商官网抓取详细的产品说明书、过敏原信息（如有）。
-   **入库准则**：明确无误的信息自动入库；模糊信息进入“人工审校区”。

## 5. 全动态商品库与预购清单同步
这是本模块的核心逻辑：
1.  **产品入库触发器**：一旦新商品入库或旧商品价格更新，系统立即启动 **“清单反向匹配”** 任务。
2.  **存量清单检查**：扫描所有活跃客户的“预购清单”，寻找匹配的占位条目（即之前用户手动描述的模糊项）。
3.  **自动内容更新**：匹配成功后，自动将正式的产品大图、确认的价格、标准的规格推送到客户与商家的预购清单视图中。

## 6. 异常、缺货与补充录入
-   **缺货标记流程**：商家在操作界面对某个商品条目执行“标记缺货”。
    -   系统响应：全链路推送消息。客户视图中该项置灰并标注“OutOfStock”标志。
-   **持续增量确认**：在采购现场，商家可随时利用 IM 界面继续粘贴客户新发来的需求，AI 实时追加到当前采购清单末尾。

### 6.2 采购实时核对 (Procurement Check-off)
为了确保不漏买，系统在采购界面提供 **“预定清单对照组”**：
-   **功能定义**：商家可调出本次行程的所有预定商品列表。
-   **打勾确认**：每放入购物车一件商品，商家在 App 上进行打勾确认。
-   **防漏提醒**：退出采购模式前，系统自动检测并提示尚未打勾的预定项。

## 7. 实时商客交互 (实时下发)
-   **照片直接共享**：
    -   **动作**：在拍摄商品的同时，界面应提供“直接同步给客户”的勾选框。
    -   **定向分发**：商家可预选某些特定客户，拍照瞬间，照片自动通过后台发送至相应 IM 窗口并附带默认或自定义留言（如：“这个有货，要吗？”）。

## 8. 技术实现建议
-   **通信协议**：采用 **WebSocket** 维持长连接，确保采购现场的变动能瞬间触达客户。
-   **图片管理**：使用 **MinIO 存储图片列表**，并为每个商品维护一个 `images[]` 数组，记录采集时间戳、坐标地点以及关联的采购员 ID。
