---
引用: PROD-02-业务功能详细说明
状态: 草案
生效日期: 2026-01-13
---

# ARCH-05: 行程发布与费用定价详细设计

## 1. 模块概述
行程发布模块是业务流的起点，负责定义采购任务的时间、地点及参与范围。同时，本模块深度集成了基于地址的费用定价体系与 AI 驱动的动态公式引擎，确保成本与收益计算的精准性。

## 2. 行程任务生命周期与分发 (Trip Lifecycle)
1.  **任务创建**：商家设定目标卖场、采购时间窗口、公告标题。
2.  **定向分发**：商家可从“存量客户列表”中勾选特定客户发送邀约。
3.  **任务关联与接纳**：
    -   客户点击邀约 -> 勾选存量商品或发送 IM 需求。
    -   **地址触发点**：客户首次加入行程时，系统强制触发“地址选择/地址创建”弹窗（商客双端均可审阅编辑）。

## 3. 商客关系自动绑定机制 (Auto-binding)
系统通过以下规则自动维护商客间的“熟客/合作关系”：
1.  **主动创建**：由商家通过 ARCH-04 手动录入的客户，自动建立永久强关联。
2.  **业务触发**：任何通过第三方渠道（IM/社交媒体）引入的客户，只要发生过以下任一行为，系统自动建立关联：
    -   **IM 聊天**（意图识别通过）。
    -   **交易支付**（完成一单）。
    -   **需求委托**（进入预购清单）。

## 4. 运费标准与地址绑定体系
### 4.1 地址运费矩阵
-   **维度**：配送地址 <-> 运费/服务费标准。
-   **存储逻辑**：无论是标准费用还是协商后的“非标费用”，均固化在用户的**地址档案记录**中。
-   **批量调整**：当商家调整全局运费标准时，系统提供“全地址遍历更新”功能，确保受影响的客户地址定价同步联动。

### 4.2 商家地区预设
-   系统支持预设“商家经营地区”标准费用表（如：东京站 10km 圈内统一运费）。
-   当用户输入地址后，系统先行匹配该标准的预设值，供双方参考。

## 5. AI 智能费用计算引擎 (Formula Engine)
为应对纷繁复杂的收费名目（运费、代购费、加急费等），系统采用 AI 驱动的公式化方案。

### 5.1 公式定义方式
1.  **自然语言输入**：商家输入“每件商品收 100 日元代购费”或“总金额超过 10000 时收 5% 处理费”。
2.  **AI 解析 (Symbolic Regression)**：AI 介入分析，将其转化为标准数学运算逻辑：
    -   `Expr1: item_count * 100`
    -   `Expr2: amount > 10000 ? amount * 0.05 : 0`
3.  **计算参与**：最终费用结算时，引擎调取变量（数量、金额、距离等）代入公式，产出透明的费用明细展示。

## 6. 交互原型建议
-   **下单预览**：客户确认清单时，界面应清晰展示：`商品原价 + AI 计算的费用（代购费/运费） = 最终应付金额`。
-   **议价入口**：支持商家在 IM 侧实时调起“地址费用覆盖”，手动修改非标运费。
