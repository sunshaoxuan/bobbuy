---
引用: PROD-02-业务功能详细说明
状态: 草案
生效日期: 2026-01-13
---

# ARCH-09: 利润结算与智能路径规划详细设计

## 1. 模块概述
本模块旨在提升商家的运营效率与财务透明度。通过行程成本的精细化核算，实现单次行程的利润分析；同时结合地理信息系统实现最优配送路径规划。

## 2. 行程成本与利润核算模型
### 2.1 成本输入 (Operating Expenses)
商家可在行程结束后，通过“结转录入”页面记录该次行程产生的直接成本：
-   **能源费用**：油费/电费。
-   **交通杂费**：高速路费、停车费、过路费。
-   **人力与物料**：餐饮费、包装袋/材料费、耗材。

### 2.2 利润计算逻辑 (Profit Calculation)
-   **总毛收 (Revenue)**：所有已核销订单的 `商品代购费 + 运费/服务费` 总和（不含商品原价）。
-   **净收益 (Net Profit)**：`总毛收 - 2.1中所列的成本之总和`。
-   **报表产出**：系统自动生成单次行程的“收支分析表”，直观展示经营效益。

## 3. 全路径智能规划 (Smart Routing)
针对多客户配送场景，系统提供一键路径优化功能。

### 3.1 路径规划流 (Routing Workflow)
1.  **节点采集**：系统自动拉取该次行程中所有已结账待交付的“送货地址”。
2.  **参数设定**：商家指定 **出发点 (Origin)** 和 **最终目的地 (Finish Point)**。
3.  **多点优化计算 (Optimizer)**：
    -   调用 Google Maps `Routes API` 或 Apple `MapKit` 环境。
    -   利用 **综合最短距离/时间算法** 对所有配送点进行重新排序（TSP 算法应用）。
4.  **展示与反馈**：
    -   界面地图显示最优路径预览。
    -   列表展示：`配送点 A -> 距离 3km -> 配送点 B -> ...`。

### 3.2 导航导出策略
-   **第三方跳转**：支持将计算好的有序途经点序列导出至外部导航 App。
-   **支持列表**：Google Maps, Apple Maps, Waze (及相关本地区域高频 App)。

## 4. UI 布局建议 (Interaction Design)
-   **结算页**：采用“瀑布式”收支明细单，下方带鲜艳的“净利润”数字展示。
-   **地图页**：全屏缩略图，右下角悬浮【导出至导航】蓝色高亮按钮。

## 5. 技术实现建议
-   **API 调用**：考虑采用 Mapbox 或 Google Maps 的专有路径优化接口。
-   **数据映射**：由于客户地址格式可能繁杂，计算前需经过 [ARCH-04](ARCH-04-参与者管理与身份认证详细设计.md) 设计的 AI 地址标准化引擎清洗。
