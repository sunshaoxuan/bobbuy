# PROD-02: 业务功能详细说明

**生效日期**: 2026-01-13
**状态**: 草案
**引用**: [BOBBuy 平台系统方案设计.docx](../BOBBuy%20平台系统方案设计.docx)

---

## 1. 业务全景流程图
平台核心逻辑在于通过 AI 智能代理衔接 IM 沟通与线下执行。

```mermaid
sequenceDiagram
    participant C as 客户
    participant S as 商家
    participant AI as AI 智能代理
    participant Sys as 后台系统

    S->>Sys: 发布 卖场采购行程 (时间/地点)
    Sys-->>C: 推送通知/展示列表
    C->>S: 发起 IM 咨询 (代购意向)
    AI->>AI: 监听聊天，识别意图与清单
    AI-->>S: 提示确认结构化清单
    S->>C: 确认清单与预估价格
    Note over C,S: 达成意向订单

    S->>S: 线下 卖场实地采购
    S->>C: IM 实时同步 (缺货/替代品照片)
    C->>S: 确认变更
    S->>Sys: 上传结算小票照片
    AI->>AI: AI 结构化识别小票内容，更新实际成本
    AI->>Sys: 自动分账与生成最终订单
    Sys->>C: 发送支付链接
    C->>Sys: 支付款项
    S->>C: 线下交付商品
    C->>Sys: 确认收货并评价
    Sys->>S:资金结算
```

## 2. 核心功能操作流程

### 2.1 商家端：行程与采购管理
1.  **行程发布**：
    -   操作：商家在移动端点击“发布行程”，选择目标卖场，设定计划出发时间及停止接单时间。
    -   系统响应：生成行程卡片，广播至对应区域。
2.  **订单确认 (AI 协作)**：
    -   详细设计请参阅 [ARCH-02-订单确认模块详细设计.md](ARCH-02-订单确认模块详细设计.md)。
    -   包含 AI 意图解析、商品库匹配、外部智能搜索及可见性控制。
3.  **采购执行与同步 (核心模块)**：
    -   详细设计请参阅 [ARCH-03-采购执行与商品采集详细设计.md](ARCH-03-采购执行与商品采集详细设计.md)。
    -   包含高频照片采集、AI 多模态解析、全动态清单同步及缺货控制。
4.  **最终结账与分单**：
    -   操作：商家结账后，拍摄原始采购账单/小票。
    -   系统响应：AI OCR 提取各单品实价，自动平摊公共费用，生成客户支付单。

### 2.3 全局辅助功能：客户管理
- **随时新增客户**：
  - 详细设计请参阅 [ARCH-04-客户快速创建与管理详细设计.md](ARCH-04-客户快速创建与管理详细设计.md)。
  - **核心逻辑**：在所有业务环节均可不中断业务流进行客户快速录入。
  - **AI 赋能**：支持自由格式地址录入，由 AI 自动标准化。

### 2.2 客户端：发现与支付流程
1.  **探索发现**：
    -   操作：客户通过区域地图或列表浏览可用的代购行程。
    -   系统响应：基于客户偏好与位置匹配。
2.  **清单交互 (AI 解析)**：
    -   操作：客户在 IM 窗口直接输入模糊的采购要求。
    -   系统响应：AI 自动解析并提示确认结构化清单。
3.  **支付与履约**：
    -   操作：客户收到 AI 汇总的最终账单，确认后跳转支付。
    -   操作：面交时，扫描商家提供的核销码完成收货。

### 2.4 AI 智能代理逻辑
-   **意图识别 (NLP)**：通过大模型实时过滤掉闲聊，提取有效指令。
-   **清单结构化**：将非标文本转为标准 SKU。
-   **AI 自动化识别**：针对当地语言的原始账单，自动对应商品实体与平台商品库。

## 3. 异常处理流程
-   **纠纷仲裁**：系统调取 AI 识别的原始账单数据对质。
-   **临时退单**：采购前可取消；采购后不可取消（除非质量问题）。

## 4. 扩展性预留
-   **多语言翻译**：自动识别主要语种并翻译。
-   **第三方交互适配**：通过 Webhook 接收主流 IM 消息，由 AI 处理。
