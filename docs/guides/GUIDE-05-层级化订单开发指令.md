# GUIDE-05: 层级化订单 UI 与后台层级逻辑开发指令

**生效日期**: 2026-01-17  
**目标**: 实现 1 行程 : N 订单头 : N 订单行 的层级化展示与管理逻辑。

---

## 1. 核心任务说明

基于 [ARCH-11](../architecture/ARCH-11-订单头行模型与业务幂等详细设计说明书.md) 的设计，程序员需要完成以下工作：

### 1.1 前端 UI 重构 (Frontend UI)
- **行程看板 (Trip Dashboard)**: 
  - 在订单页面顶部，增加一个概览区域，显示 `Trip` 的目的地、日期及当前已用容量。
- **订单头卡片 (Order Header Cards)**:
  - 将订单列表改为“折叠面板 (Collapse/Accordion)”或“下钻列表”。
  - 每个面板头部显示 `OrderHeader` 关键信息（客户、业务单号、总金额、状态）。
- **订单行明细 (Order Line Items)**:
  - 点击面板后，展开展示该订单下的 `lines` 列表（表格形式）。
  - 支持在展开区内进行“状态修改”操作，但操作对象是所属的 `OrderHeader`。

### 1.2 后端逻辑对齐 (Backend Logic)
- **数据查询**:
  - 确保 `listOrders` 返回的数据是按 `tripId` 分组的。
  - 前端请求时，应能通过 `/api/orders?tripId=xxx` 获取特定行程下的所有订单头。

---

## 2. 实现约束 (Constraints)

1. **不可破坏现有幂等逻辑**: `upsertOrder` 的合并规则（SKU + Spec）必须保持不变。
2. **状态流转**: 订单状态（NEW -> CONFIRMED -> ...）依然挂载在 `OrderHeader` 上。
3. **视觉风格**: 严格遵守项目现有的“简约白”与微动画风格。

---

## 3. 验收标准 (Acceptance Criteria)
- [ ] 页面顶部清晰展示行程信息。
- [ ] 订单以客户/业务单号为单位进行分组折叠。
- [ ] 点击折叠区能看到所属的所有商品行明细。
- [ ] 状态更改功能正常且仅对操作的 Header 生效。
