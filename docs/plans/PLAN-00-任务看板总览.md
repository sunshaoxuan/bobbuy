# PLAN-00: 任务看板总览

**最后更新**: 2026-01-16 11:27  
**状态图例**: ✅ 已完成 | 🔄 进行中 | ⏳ 待开始

---

## 📊 整体进度总览

| 计划编号 | 计划名称 | 状态 | 完成度 | 核心目标 | 负责人 |
|------|------|--------|----------|----------|--------|
| [PLAN-01](PLAN-01-下一阶段开发任务规划.md) | MVP核心功能规划 | ✅ 已完成 | 100% | 补齐订单/行程核心链路 | 全栈团队 |
| [PLAN-02](PLAN-02-测试覆盖率提升计划.md) | 质量与债务专项 | ✅ 已完成 | 100% | 铁律攻坚 90/70 达标 | 全栈团队 |
| [PLAN-03](PLAN-03-第一周开发任务优先级与实施计划.md) | 第1周执行计划 | ✅ 已完成 | 100% | P0任务激活与质量红线 | 全栈团队 |
| [PLAN-04](PLAN-04-Sprint-3执行计划.md) | Sprint 3 执行计划 | ✅ 已完成 | 100% | 核心业务链路 E2E 验证 | 全栈团队 |
| [PLAN-05](PLAN-05-Sprint-4执行计划.md) | Sprint 4 执行计划 | ✅ 已完成 | 100% | 性能加固与生产就绪 | 全栈团队 |
| [PLAN-06](PLAN-06-订单重构实施方案.md) | 订单重构实施 | ✅ 已完成 | 100% | 详设驱动的头行架构重构 | 开发团队 |
| [PROD-03](../requirements/PROD-03-订单业务幂等与合并需求详细规格说明书.md) | 业务需求规约 | ✅ 已发布 | 100% | 独立业务合并与幂等判准 | 产品经理 |
| [ARCH-11](../architecture/ARCH-11-订单头行模型与业务幂等详细设计说明书.md) | 系统详细设计 | ✅ 已发布 | 100% | 类设计/算法/并发控制方案 | 架构师 |
| [GUIDE-05](../guides/GUIDE-05-层级化订单开发指令.md) | 程序员开发指令 | ✅ 已发布 | 100% | 1:N:N 层级化 UI 驱动指令 | 架构师 |
| [GUIDE-06](../guides/GUIDE-06-订单履行流转与状态联动开发指令.md) | 程序员开发指令 | ✅ 已发布 | 100% | 状态批量操作与容量联动 | 架构师 |
| [GUIDE-07](../guides/GUIDE-07-异常流转与结算预备开发指令.md) | 程序员开发指令 | ✅ 已发布 | 100% | 订单取消、容量释放与结算字段 | 架构师 |

### 📖 计划体系说明
- **PLAN-01 (战略)**: 业务功能的宏观路线图，定义 Sprint 1-3 的业务目标。
- **PLAN-02 (专项)**: 针对 AUDIT-04 提出的质量赤字，制定的中长期技术债务清偿方案。
- **PLAN-03 (战术)**: **当前执行入口**。从 PLAN-01 和 PLAN-02 中提取 P0 级任务，进行混合排期（功能+质量）。

---

## 📋 PLAN-01: 下一阶段开发任务规划

### Sprint 1（基础功能完备）- ✅ 已完成

#### 后端开发
- [x] **数据模型增强**
  - [x] 订单生命周期字段与状态更新时间
  - [x] 行程容量与剩余容量计算逻辑
  - [x] 基础费用字段（服务费、预计税费、货币类型）

- [x] **API 设计与实现**
  - [x] 订单状态流转接口（PATCH /api/orders/{id}/status）
  - [x] 行程可用容量校验与锁定接口（POST /api/trips/{id}/reserve）
  - [x] 指标接口补充（按状态统计订单数量）

- [x] **校验与错误码**
  - [x] 统一错误响应结构（ApiResponse + ErrorCode）
  - [x] 参数校验（Java Validation API）

#### 前端开发
- [x] **表单完善**
  - [x] 行程创建表单（日期、容量、状态）
  - [x] 订单创建表单（服务费、币种）

- [x] **状态可视化**
  - [x] 订单状态标签（Ant Design Tag）
  - [x] 行程状态标签

- [x] **数据校验提示**
  - [x] 表单必填与范围校验
  - [x] 关键字段展示说明

---

### Sprint 2（流程闭环与可观测）- ✅ 已完成

#### 后端开发
- [x] **基础审计日志**
  - [x] 订单状态变化日志（AuditLogService）
  - [x] 行程状态变化日志

- [ ] **可观测性**
  - [x] 健康检查接口（HealthController）
  - [x] 指标接口（MetricsController）
  - [x] 全量 API 统一日志规范化实现 (通过 RequestLoggingInterceptor 架构锁定)

#### 前端开发
- [x] **流程动作按钮**
  - [x] 订单状态流转按钮 (✅ 已发布)
  - [x] 行程状态变更入口 (✅ 已发布)

- [x] **日志与提醒**
  - [x] 订单状态变更记录展示 (通过单元测试验证逻辑)
  - [x] 异常提醒与空态引导 (✅ 已全量覆盖)

---

### Sprint 3（质量与验收）- ✅ 已完成

#### 后端开发
- [x] **测试用例攻坚**
  - [x] 单元测试铁律达标 (Backend Line 92%, Branch 76%)
  - [x] 接口集成测试 (OrderController 100% 覆盖)
- [x] **架构与可靠性**
  - [x] 全量 API 日志规范化 (拦截器全量覆盖)
  - [x] 并发场景验证 (reserveTripCapacity 锁机制验证)

- [x] **端到端验收列表**
  - [x] MVP 核心链路操作清单 (Playwright 已覆盖)
  
---

## 📋 PLAN-02: 测试覆盖率提升计划

### Phase 1: 测试基础设施建设 - ⏳ 待开始
**截止日期**: 2026-01-16

- [x] **后端测试配置**
  - [x] 配置 JaCoCo 插件 (pom.xml)
  - [x] 验证覆盖率报告生成 (47.4% 基线已建立)

- [x] **前端测试配置**
  - [x] 安装测试依赖 (Vitest + Testing Library)
  - [x] 创建 vitest.config.ts
  - [x] 创建测试工具文件 (setup.ts)

---

### Phase 2: 后端单元测试补充 - ✅ 已完成

- [x] **BobbuyStore 完整测试**
  - [x] 订单 CRUD 测试 (100% 覆盖)
  - [x] 订单状态流转测试 (100% 覆盖)
  - [x] 行程容量测试 (含并发验证)
  - **当前状态**: 行覆盖率 **100%** (已覆盖 Optional/异常分支)

- [x] **AuditLogService 测试**
  - [x] 日志记录测试 (100% 覆盖)
  - **当前状态**: 行覆盖率 100%

---

- [x] **Orders 组件测试**
  - [x] 表单渲染测试
  - [x] 表单提交测试
  - [x] 成功/失败消息测试
  - **当前状态**: 行覆盖率 83% (红线达标)

- [ ] **Trips 组件测试** (计划转入下周)
  - [ ] 表单渲染测试
  - [ ] 容量计算测试

- [x] **i18n 功能测试**
  - [x] 默认语言测试
  - [x] 语言切换测试
  - [x] 翻译正确性测试

---

- [x] Sprint 3 Phase 1 (E2E & Integration): `OrderController` 100% 覆盖, 日志规范化完成。

- [x] **并发控制修复**
  - [x] 添加 synchronized 锁机制
  - [x] 补充并发测试用例 (✅ 验证通过)

---

## 🎯 里程碑与验收标准

### 里程碑 1: Sprint 1 完成 ✅
**成果**: 
- 数据模型完整
- API 接口实现
- 前端表单可用
- I18n 支持完整

### 里程碑 2: 测试基础设施就绪 ⏳
**验收标准**:
- [x] JaCoCo 报告可生成
- [x] Vitest 可运行测试
- [x] 覆盖率工具配置完成

### 里程碑 3: 测试覆盖率基线达标 ✅
**验收标准**:
- [x] 后端核心 (BobbuyStore) **100%** (目标 ≥90%)
- [x] 分支覆盖率 **87%** (目标 ≥70%)
- [x] 前端页面 (Orders.tsx) ≥60% (实际 83%)
- [x] 并发漏洞修复完成

---

## 🔴 阻塞问题与技术债务

### 高优先级（P0）
1. ✅ **测试覆盖率不足** - 来源: AUDIT-04
   - 现状: 后端 92%/76%, 前端 83% (Orders)
   - 状态: ✅ **已闭环 (铁律锁定)**

2. ✅ **未配置覆盖率工具** - 来源: AUDIT-04
   - 状态: ✅ 已集成 JaCoCo & Vitest

### 中优先级（P1）
3. ✅ **并发控制缺失** - 来源: AUDIT-01
   - 状态: ✅ 已通过 synchronized 修复

4. ❌ **Controller 层无测试** - 来源: AUDIT-04
   - 影响: API 回归风险高
   - 截止: 2026-01-23
   - 状态: ⏳ 可选

### 低优先级（P2）
5. ✅ **E2E 测试缺失** - 来源: AUDIT-01
   - 状态: ✅ Playwright 基线已通过 (AUDIT-07)

---

## 📈 进度统计

### 总体完成度
- **PLAN-01 Sprint 1**: 100% ✅
- **PLAN-01 Sprint 2**: 100% ✅
- **PLAN-01 Sprint 3**: 100% ✅
- **PLAN-05 Sprint 4**: 0% ⏳ (规划中)

### 测试覆盖率进度
| 模块 | 当前 | 铁律目标 | 长期目标 |
|------|------|-------------|----------|
| 后端 - Line | **92%** | 90% | 95% |
| 后端 - Branch | **76%** | 70% | 85% |
| 前端 - Line | **81.6%** | 60% | 75% |

### 技术债务清偿进度
- **已解决**: 7/8（87%）
  - ✅ 前端提交逻辑
  - ✅ I18n 支持
  - ✅ 审计日志与追溯 (`trace_id`)
  - ✅ API 文档与契约
  - ✅ 测试覆盖率 (90/70 铁律达标)
  - ✅ 并发控制安全性
  - ✅ Controller 集成测试

- **未解决**: 1/8（12%）
  - ❌ E2E 测试 (基线已过，等待全链路覆盖)

---

## 🚀 下一步行动 (本周重点)

**所有执行细节请参见 [PLAN-03: 第一周开发任务执行计划](PLAN-03-第一周开发任务优先级与实施计划.md)**

1. **立即启动 (P0)**: 
   - [ ] 前端：Playwright E2E 全链路闭环 (PLAN-04)
   - [ ] 前端：Trips 组件测试补齐 (Phase 3)

2. **长期演进 (P1)**:
   - [ ] 全量 UI 还原度审计
   - [ ] 自动化部署门禁校验

---

**备注**: 
- 本看板作为索引每日更新，**具体任务描述以各子计划文档为准**。
- 程序员应首先签出 `PLAN-03` 进行当日工作。
