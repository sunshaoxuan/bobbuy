# PLAN-05: Sprint 4 生产就绪加固计划

**制定日期**: 2026-01-16  
**状态**: ⏳ 待开始  
**目标**: 将项目质量从“铁律锁定”推向“生产就绪”，重点解决性能瓶颈、基础安全性及用户交互体验的深度打磨。

---

## 1. 核心任务矩阵 (Sprint 4 Focus)

| 领域 | 任务内容 | 优先级 | 预期产出 |
| :--- | :--- | :--- | :--- |
| **性能** | **全链路性能 Baseline 监控** | **P0** | 基于 `cost_ms` 自动记录并导出性能报告，识别 Top 3 慢接口。 |
| **安全** | **防重放与基础越权校验** | **P0** | 实现请求防抖锁，确认为代购核心链路提供幂等保护。 |
| **体验** | **UI 还原度终审与响应式优化** | **P1** | 对齐移动端适配，消除 Ant Design 组件的默认“act”告警。 |
| **工程** | **CI 自动化覆盖率门禁强制执行** | **P1** | 将覆盖率报告自动同步至 PR 评论，实现物理强约束。 |

---

## 2. 细节设计与交付标准

### 2.1 性能监控自动化
- **设计**: 利用 `RequestLoggingInterceptor` 累积的 `cost_ms`，在 `/api/metrics` 接口增加百分位数（P95/P99）统计。
- **阈值**: 核心流转接口（PATCH status）在正常并发下耗时需 `≤ 200ms`。

### 2.2 防抖与幂等保护
- **后端**: 针对 `POST /api/orders` 引入基于 `trace_id` 的短效缓存锁，防止用户连续快速点击导致的重复下单。
- **前端**: 按钮提交后强制进入 `loading` 状态，直至 API 返回，从源头降低并发风险。

### 2.3 UI/UX 深度打磨
- **适配性**: 确保订单列表在 pad/手机屏幕下的弹性布局（Flex/Grid 补齐）。
- **告警消除**: 修正 `act(...)` 警告，将所有数据变更包裹在正确的 React 生命周期中，保证单测日志“洁净”。

---

## 3. 分阶段实施排期

### 阶段一: 观测与响应 (Observability & Response)
- [ ] 性能指标 P95/P99 聚合逻辑实现。
- [ ] 前端提交防抖锁定与 Loading 态全量覆盖。

### 阶段二: 安全与适配 (Security & Responsiveness)
- [ ] 服务端请求幂等性校验拦截。
- [ ] 移动端布局还原度审计与修复。

---

## 4. 验收标准
- [ ] **性能**: 全部 API 响应耗时 100% 记录，主要接口 P99 < 500ms。
- [ ] **安全**: 模拟快速连续点击测试，后端拦截率 100%。
- [ ] **日志**: 单测执行日志实现“0 Warning”。

---

**负责人**: 全栈团队  
**评审人**: Tech Lead  
**关联文档**: [PLAN-00-任务看板总览](file:///c:/workspace/bobbuy/docs/plans/PLAN-00-%E4%BB%BB%E5%8A%A1%E7%9C%8B%E6%9D%BF%E6%80%BB%E8%A7%88.md)
