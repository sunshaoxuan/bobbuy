---
引用: REQ-02-业务功能详细说明
状态: 草案
生效日期: 2026-01-13
---

# REQ-03-订单确认模块详细设计

## 1. 模块概述
订单确认是连接客户原始需求与平台标准化订单的关键环节。通过 AI 技术对非结构化的 IM 聊天记录进行实时解析，形成商客双方可感知的预购清单，并支持商家对商品信息的深度补全与可见性控制。

## 2. 操作流程与 UI 设计

### 2.1 手机端 (Mobile-First)
-   **交互原则**：紧凑但不拥挤，操作区域易于点击。
-   **界面布局**：
    -   **双窗格模型**：上方或左侧为聊天记录粘贴/读取窗口；下方或右侧为实时生成的“预购清单”。
    -   **视图切换**：
        -   **列表视图**：小图、突出显示品名、规格、数量（适用于快速核对）。
        -   **画廊视图**：大图预览，下方展示详细参数（适用于精细信息补全）。
-   **可见性开关**：每个商品条目旁设有“客户可见”拨动开关。

### 2.2 Web 端
-   **交互原则**：专业、美观、高效率。
-   **界面布局**：采用左右分屏布局，左侧为全文聊天回溯，右侧为带有多tab的商品编辑表单。

## 3. 数据入口与处理逻辑

### 3.1 数据输入 (Data Input)
1.  **手动粘贴**：用户将微信、Line 等 App 中的聊天记录复制并粘贴至输入框。
2.  **IM 接口对接 (调查建议)**：
    -   **Line**：利用 Messaging API 的 Webhook，可实时接收并处理用户发送的消息。
    -   **微信**：服务号/小程序可通过 Webhook 接收消息；个人号需通过辅助工具或提醒用户粘贴。
    -   **同步策略**：系统实时监听粘贴动作或 Webhook 回调，触发 AI 分析。

### 3.2 AI 分析引擎
1.  **模型选型**：
    -   推荐使用 **LLM (如 GPT-4o 或 Claude 3.5)** 进行语义提取。由于代购语言描述极其模糊（例如“上次那个红色的坚果”），小模型往往难以处理上下文关联。
2.  **处理规则**：
    -   **第一轮提取**：从文本中提取品名、规格关键词、数量倾向。
    -   **商品库匹配**：优先检索内部商品库，完全匹配的直接标记为“已入库”。
    -   **外部智能搜素**：
        -   **目标**：无匹配时，调用搜索接口（Google Search API、Costco 官网爬虫）。
        -   **采集内容**：商品官方名称、官方大图、详细规格说明、Costco 商品编号或 UPC 码。
    -   **入库准则**：
        -   **明确匹配**：AI 分析搜索结果确认为 Costco 产品的，进入临时商品条目。
        -   **模糊匹配**：AI 无法定位到具体产品的，写入“待选清单”，由商家手动干预。

## 4. 订单控制与修改机制
-   **生命周期控制**：从预购清单生成到最终送货完毕前，商家拥有最高修改权限。包含：
    -   修改单价、数量。
    -   替换产品图。
    -   补充/修改商品编码。
-   **价格歧视与隐私保护**：
    -   **默认状态**：所有外部搜索来的图片和价格对客户 **默认关闭**。
    -   **显式授权**：商家必须明确点击“授权可见”按钮，客户才能在其端看到相关图片详细信息。
    -   **价格隔离**：商家可以看到采购成本价与代购价，客户仅可见商家设定的最终代购价。

## 5. 数据出口与订单成立
-   **出口 1 (客户确认流)**：导出一张包含“商家授权图片+客户原始文字+最终确认规格+价格”的确认卡片至 IM 对话。
-   **出口 2 (系统订单流)**：将确认后的预购清单持久化为正式订单，触发库存（如有）与财务流水。

## 6. 技术要点
-   **搜索 API**：Google Custom Search API 或特定的电商爬行器。
-   **前端响应**：使用 WebSocket 确保“边粘边解析”的实时反馈感。
-   **图像托管**：官方大图需抓取并存储于私有 OSS，防止外部链接失效。
